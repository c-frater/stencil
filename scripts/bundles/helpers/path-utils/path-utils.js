/*! Copyright the Browserify authors, ported from Deno source. MIT License. */
export const getPathUtils=e=>{const t={},r={cwd:e.cwd,env:e.env,isWindows:!!e.isWindows};function n(e){if("string"!=typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}function o(e){return 47===e}function l(e){return o(e)||92===e}function i(e){return e>=97&&e<=122||e>=65&&e<=90}function c(e,t,r,n){let o,l="",i=0,c=-1,h=0;for(let f=0,s=e.length;f<=s;++f){if(f<s)o=e.charCodeAt(f);else{if(n(o))break;o=47}if(n(o)){if(c===f-1||1===h);else if(c!==f-1&&2===h){if(l.length<2||2!==i||46!==l.charCodeAt(l.length-1)||46!==l.charCodeAt(l.length-2)){if(l.length>2){const e=l.lastIndexOf(r);-1===e?(l="",i=0):(l=l.slice(0,e),i=l.length-1-l.lastIndexOf(r)),c=f,h=0;continue}if(2===l.length||1===l.length){l="",i=0,c=f,h=0;continue}}t&&(l.length>0?l+=r+"..":l="..",i=2)}else l.length>0?l+=r+e.slice(c+1,f):l=e.slice(c+1,f),i=f-c-1;c=f,h=0}else 46===o&&-1!==h?++h:h=-1}return l}function h(...e){let t="",l=!1;for(let o=e.length-1;o>=-1&&!l;o--){let i;if(o>=0)i=e[o];else{if(null==globalThis.ctx)throw new TypeError("Resolved a relative path without a CWD.");i=r.cwd()}n(i),0!==i.length&&(t=`${i}/${t}`,l=47===i.charCodeAt(0))}return t=c(t,!l,"/",o),l?t.length>0?"/"+t:"/":t.length>0?t:"."}function f(e){if(n(e),0===e.length)return".";const t=47===e.charCodeAt(0),r=47===e.charCodeAt(e.length-1);return 0!==(e=c(e,!t,"/",o)).length||t||(e="."),e.length>0&&r&&(e+="/"),t?"/"+e:e}class s extends Error{constructor(e){super(e),this.name="ctxStdInternalError"}}function a(...e){let t="",o="",h=!1;for(let c=e.length-1;c>=-1;c--){let f;if(c>=0)f=e[c];else if(t){if(null==globalThis.ctx)throw new TypeError("Resolved a relative path without a CWD.");f=r.env.get("="+t)||r.cwd(),void 0!==f&&f.slice(0,3).toLowerCase()===t.toLowerCase()+"\\"||(f=t+"\\")}else{if(null==globalThis.ctx)throw new TypeError("Resolved a drive-letter-less path without a CWD.");f=r.cwd()}n(f);const s=f.length;if(0===s)continue;let a=0,d="",u=!1;const g=f.charCodeAt(0);if(s>1)if(l(g))if(u=!0,l(f.charCodeAt(1))){let e=2,t=e;for(;e<s&&!l(f.charCodeAt(e));++e);if(e<s&&e!==t){const r=f.slice(t,e);for(t=e;e<s&&l(f.charCodeAt(e));++e);if(e<s&&e!==t){for(t=e;e<s&&!l(f.charCodeAt(e));++e);e===s?(d=`\\\\${r}\\${f.slice(t)}`,a=e):e!==t&&(d=`\\\\${r}\\${f.slice(t,e)}`,a=e)}}}else a=1;else i(g)&&58===f.charCodeAt(1)&&(d=f.slice(0,2),a=2,s>2&&l(f.charCodeAt(2))&&(u=!0,a=3));else l(g)&&(a=1,u=!0);if(!(d.length>0&&t.length>0&&d.toLowerCase()!==t.toLowerCase())&&(0===t.length&&d.length>0&&(t=d),h||(o=`${f.slice(a)}\\${o}`,h=u),h&&t.length>0))break}return o=c(o,!h,"\\",l),t+(h?"\\":"")+o||"."}function d(e){n(e);const t=e.length;if(0===t)return".";let r,o=0,h=!1;const f=e.charCodeAt(0);if(t>1)if(l(f))if(h=!0,l(e.charCodeAt(1))){let n=2,i=n;for(;n<t&&!l(e.charCodeAt(n));++n);if(n<t&&n!==i){const c=e.slice(i,n);for(i=n;n<t&&l(e.charCodeAt(n));++n);if(n<t&&n!==i){for(i=n;n<t&&!l(e.charCodeAt(n));++n);if(n===t)return`\\\\${c}\\${e.slice(i)}\\`;n!==i&&(r=`\\\\${c}\\${e.slice(i,n)}`,o=n)}}}else o=1;else i(f)&&58===e.charCodeAt(1)&&(r=e.slice(0,2),o=2,t>2&&l(e.charCodeAt(2))&&(h=!0,o=3));else if(l(f))return"\\";let s;return s=o<t?c(e.slice(o),!h,"\\",l):"",0!==s.length||h||(s="."),s.length>0&&l(e.charCodeAt(t-1))&&(s+="\\"),void 0===r?h?s.length>0?"\\"+s:"\\":s.length>0?s:"":h?s.length>0?`${r}\\${s}`:r+"\\":s.length>0?r+s:r}const u={basename:function(e,t=""){if(void 0!==t&&"string"!=typeof t)throw new TypeError('"ext" argument must be a string');n(e);let r,o=0,l=-1,i=!0;if(void 0!==t&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";let n=t.length-1,c=-1;for(r=e.length-1;r>=0;--r){const h=e.charCodeAt(r);if(47===h){if(!i){o=r+1;break}}else-1===c&&(i=!1,c=r+1),n>=0&&(h===t.charCodeAt(n)?-1==--n&&(l=r):(n=-1,l=c))}return o===l?l=c:-1===l&&(l=e.length),e.slice(o,l)}for(r=e.length-1;r>=0;--r)if(47===e.charCodeAt(r)){if(!i){o=r+1;break}}else-1===l&&(i=!1,l=r+1);return-1===l?"":e.slice(o,l)},dirname:function(e){if(n(e),0===e.length)return".";const t=47===e.charCodeAt(0);let r=-1,o=!0;for(let t=e.length-1;t>=1;--t)if(47===e.charCodeAt(t)){if(!o){r=t;break}}else o=!1;return-1===r?t?"/":".":t&&1===r?"//":e.slice(0,r)},extname:function(e){n(e);let t=-1,r=0,o=-1,l=!0,i=0;for(let n=e.length-1;n>=0;--n){const c=e.charCodeAt(n);if(47!==c)-1===o&&(l=!1,o=n+1),46===c?-1===t?t=n:1!==i&&(i=1):-1!==t&&(i=-1);else if(!l){r=n+1;break}}return-1===t||-1===o||0===i||1===i&&t===o-1&&t===r+1?"":e.slice(t,o)},isAbsolute:function(e){return n(e),e.length>0&&47===e.charCodeAt(0)},join:function(...e){if(0===e.length)return".";let t;for(let r=0,o=e.length;r<o;++r){const o=e[r];n(o),o.length>0&&(t?t+="/"+o:t=o)}return t?f(t):"."},normalize:f,relative:function(e,t){if(n(e),n(t),e===t)return"";if((e=h(e))===(t=h(t)))return"";let r=1;const o=e.length;for(;r<o&&47===e.charCodeAt(r);++r);const l=o-r;let i=1;const c=t.length;for(;i<c&&47===t.charCodeAt(i);++i);const f=c-i,s=l<f?l:f;let a=-1,d=0;for(;d<=s;++d){if(d===s){if(f>s){if(47===t.charCodeAt(i+d))return t.slice(i+d+1);if(0===d)return t.slice(i+d)}else l>s&&(47===e.charCodeAt(r+d)?a=d:0===d&&(a=0));break}const n=e.charCodeAt(r+d);if(n!==t.charCodeAt(i+d))break;47===n&&(a=d)}let u="";for(d=r+a+1;d<=o;++d)d!==o&&47!==e.charCodeAt(d)||(0===u.length?u+="..":u+="/..");return u.length>0?u+t.slice(i+a):(i+=a,47===t.charCodeAt(i)&&++i,t.slice(i))},resolve:h,sep:"/",delimiter:":"},g={basename:function(e,t=""){if(void 0!==t&&"string"!=typeof t)throw new TypeError('"ext" argument must be a string');n(e);let r,o=0,c=-1,h=!0;if(e.length>=2&&i(e.charCodeAt(0))&&58===e.charCodeAt(1)&&(o=2),void 0!==t&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";let n=t.length-1,i=-1;for(r=e.length-1;r>=o;--r){const f=e.charCodeAt(r);if(l(f)){if(!h){o=r+1;break}}else-1===i&&(h=!1,i=r+1),n>=0&&(f===t.charCodeAt(n)?-1==--n&&(c=r):(n=-1,c=i))}return o===c?c=i:-1===c&&(c=e.length),e.slice(o,c)}for(r=e.length-1;r>=o;--r)if(l(e.charCodeAt(r))){if(!h){o=r+1;break}}else-1===c&&(h=!1,c=r+1);return-1===c?"":e.slice(o,c)},dirname:function(e){n(e);const t=e.length;if(0===t)return".";let r=-1,o=-1,c=!0,h=0;const f=e.charCodeAt(0);if(t>1)if(l(f)){if(r=h=1,l(e.charCodeAt(1))){let n=2,o=n;for(;n<t&&!l(e.charCodeAt(n));++n);if(n<t&&n!==o){for(o=n;n<t&&l(e.charCodeAt(n));++n);if(n<t&&n!==o){for(o=n;n<t&&!l(e.charCodeAt(n));++n);if(n===t)return e;n!==o&&(r=h=n+1)}}}}else i(f)&&58===e.charCodeAt(1)&&(r=h=2,t>2&&l(e.charCodeAt(2))&&(r=h=3));else if(l(f))return e;for(let r=t-1;r>=h;--r)if(l(e.charCodeAt(r))){if(!c){o=r;break}}else c=!1;if(-1===o){if(-1===r)return".";o=r}return e.slice(0,o)},extname:function(e){n(e);let t=0,r=-1,o=0,c=-1,h=!0,f=0;e.length>=2&&58===e.charCodeAt(1)&&i(e.charCodeAt(0))&&(t=o=2);for(let n=e.length-1;n>=t;--n){const t=e.charCodeAt(n);if(l(t)){if(!h){o=n+1;break}}else-1===c&&(h=!1,c=n+1),46===t?-1===r?r=n:1!==f&&(f=1):-1!==r&&(f=-1)}return-1===r||-1===c||0===f||1===f&&r===c-1&&r===o+1?"":e.slice(r,c)},isAbsolute:function(e){n(e);const t=e.length;if(0===t)return!1;const r=e.charCodeAt(0);return!!l(r)||!!(i(r)&&t>2&&58===e.charCodeAt(1)&&l(e.charCodeAt(2)))},join:function(...e){const t=e.length;if(0===t)return".";let r,o=null;for(let l=0;l<t;++l){const t=e[l];n(t),t.length>0&&(void 0===r?r=o=t:r+="\\"+t)}if(void 0===r)return".";let i=!0,c=0;if(function(e,t=""){if(!e)throw new s(t)}(null!=o),l(o.charCodeAt(0))){++c;const e=o.length;e>1&&l(o.charCodeAt(1))&&(++c,e>2&&(l(o.charCodeAt(2))?++c:i=!1))}if(i){for(;c<r.length&&l(r.charCodeAt(c));++c);c>=2&&(r="\\"+r.slice(c))}return d(r)},normalize:d,relative:function(e,t){if(n(e),n(t),e===t)return"";const r=a(e),o=a(t);if(r===o)return"";if((e=r.toLowerCase())===(t=o.toLowerCase()))return"";let l=0,i=e.length;for(;l<i&&92===e.charCodeAt(l);++l);for(;i-1>l&&92===e.charCodeAt(i-1);--i);const c=i-l;let h=0,f=t.length;for(;h<f&&92===t.charCodeAt(h);++h);for(;f-1>h&&92===t.charCodeAt(f-1);--f);const s=f-h,d=c<s?c:s;let u=-1,g=0;for(;g<=d;++g){if(g===d){if(s>d){if(92===t.charCodeAt(h+g))return o.slice(h+g+1);if(2===g)return o.slice(h+g)}c>d&&(92===e.charCodeAt(l+g)?u=g:2===g&&(u=3));break}const r=e.charCodeAt(l+g);if(r!==t.charCodeAt(h+g))break;92===r&&(u=g)}if(g!==d&&-1===u)return o;let C="";for(-1===u&&(u=0),g=l+u+1;g<=i;++g)g!==i&&92!==e.charCodeAt(g)||(0===C.length?C+="..":C+="\\..");return C.length>0?C+o.slice(h+u,f):(h+=u,92===o.charCodeAt(h)&&++h,o.slice(h,f))},resolve:a,sep:"\\",delimiter:";"};return g.posix=u.posix=u,g.win32=u.win32=g,t.isGlob=function(e){const t={"{":"}","(":")","[":"]"},r=/\\(.)|(^!|\*|[\].+)]\?|\[[^\\\]]+\]|\{[^\\}]+\}|\(\?[:!=][^\\)]+\)|\([^|]+\|[^\\)]+\))/;if(""===e)return!1;let n;for(;n=r.exec(e);){if(n[2])return!0;let r=n.index+n[0].length;const o=n[1],l=o?t[o]:null;if(o&&l){const t=e.indexOf(l,r);-1!==t&&(r=t+1)}e=e.slice(r)}return!1},t.posix=u,t.win32=g,t};
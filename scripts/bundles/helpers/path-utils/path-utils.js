export const getPathUtils=e=>{const t={},r={cwd:e.cwd,env:e.env,isWindows:!!e.isWindows};function n(e){if("string"!=typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}function o(e){return 47===e}function i(e){return o(e)||92===e}function l(e){return e>=97&&e<=122||e>=65&&e<=90}function c(e,t,r,n){let o,i="",l=0,c=-1,f=0;for(let h=0,s=e.length;h<=s;++h){if(h<s)o=e.charCodeAt(h);else{if(n(o))break;o=47}if(n(o)){if(c===h-1||1===f);else if(c!==h-1&&2===f){if(i.length<2||2!==l||46!==i.charCodeAt(i.length-1)||46!==i.charCodeAt(i.length-2)){if(i.length>2){const e=i.lastIndexOf(r);-1===e?(i="",l=0):(i=i.slice(0,e),l=i.length-1-i.lastIndexOf(r)),c=h,f=0;continue}if(2===i.length||1===i.length){i="",l=0,c=h,f=0;continue}}t&&(i.length>0?i+=r+"..":i="..",l=2)}else i.length>0?i+=r+e.slice(c+1,h):i=e.slice(c+1,h),l=h-c-1;c=h,f=0}else 46===o&&-1!==f?++f:f=-1}return i}function f(...e){let t="",i=!1;for(let o=e.length-1;o>=-1&&!i;o--){let l;if(o>=0)l=e[o];else{if(null==globalThis.ctx)throw new TypeError("Resolved a relative path without a CWD.");l=r.cwd()}n(l),0!==l.length&&(t=`${l}/${t}`,i=47===l.charCodeAt(0))}return t=c(t,!i,"/",o),i?t.length>0?"/"+t:"/":t.length>0?t:"."}function h(e){if(n(e),0===e.length)return".";const t=47===e.charCodeAt(0),r=47===e.charCodeAt(e.length-1);return 0!==(e=c(e,!t,"/",o)).length||t||(e="."),e.length>0&&r&&(e+="/"),t?"/"+e:e}class s extends Error{constructor(e){super(e),this.name="ctxStdInternalError"}}function a(...e){let t="",o="",f=!1;for(let c=e.length-1;c>=-1;c--){let h;if(c>=0)h=e[c];else if(t){if(null==globalThis.ctx)throw new TypeError("Resolved a relative path without a CWD.");h=r.env.get("="+t)||r.cwd(),void 0!==h&&h.slice(0,3).toLowerCase()===t.toLowerCase()+"\\"||(h=t+"\\")}else{if(null==globalThis.ctx)throw new TypeError("Resolved a drive-letter-less path without a CWD.");h=r.cwd()}n(h);const s=h.length;if(0===s)continue;let a=0,d="",u=!1;const g=h.charCodeAt(0);if(s>1)if(i(g))if(u=!0,i(h.charCodeAt(1))){let e=2,t=e;for(;e<s&&!i(h.charCodeAt(e));++e);if(e<s&&e!==t){const r=h.slice(t,e);for(t=e;e<s&&i(h.charCodeAt(e));++e);if(e<s&&e!==t){for(t=e;e<s&&!i(h.charCodeAt(e));++e);e===s?(d=`\\\\${r}\\${h.slice(t)}`,a=e):e!==t&&(d=`\\\\${r}\\${h.slice(t,e)}`,a=e)}}}else a=1;else l(g)&&58===h.charCodeAt(1)&&(d=h.slice(0,2),a=2,s>2&&i(h.charCodeAt(2))&&(u=!0,a=3));else i(g)&&(a=1,u=!0);if(!(d.length>0&&t.length>0&&d.toLowerCase()!==t.toLowerCase())&&(0===t.length&&d.length>0&&(t=d),f||(o=`${h.slice(a)}\\${o}`,f=u),f&&t.length>0))break}return o=c(o,!f,"\\",i),t+(f?"\\":"")+o||"."}function d(e){n(e);const t=e.length;if(0===t)return".";let r,o=0,f=!1;const h=e.charCodeAt(0);if(t>1)if(i(h))if(f=!0,i(e.charCodeAt(1))){let n=2,l=n;for(;n<t&&!i(e.charCodeAt(n));++n);if(n<t&&n!==l){const c=e.slice(l,n);for(l=n;n<t&&i(e.charCodeAt(n));++n);if(n<t&&n!==l){for(l=n;n<t&&!i(e.charCodeAt(n));++n);if(n===t)return`\\\\${c}\\${e.slice(l)}\\`;n!==l&&(r=`\\\\${c}\\${e.slice(l,n)}`,o=n)}}}else o=1;else l(h)&&58===e.charCodeAt(1)&&(r=e.slice(0,2),o=2,t>2&&i(e.charCodeAt(2))&&(f=!0,o=3));else if(i(h))return"\\";let s;return s=o<t?c(e.slice(o),!f,"\\",i):"",0!==s.length||f||(s="."),s.length>0&&i(e.charCodeAt(t-1))&&(s+="\\"),void 0===r?f?s.length>0?"\\"+s:"\\":s.length>0?s:"":f?s.length>0?`${r}\\${s}`:r+"\\":s.length>0?r+s:r}const u={basename:function(e,t=""){if(void 0!==t&&"string"!=typeof t)throw new TypeError('"ext" argument must be a string');n(e);let r,o=0,i=-1,l=!0;if(void 0!==t&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";let n=t.length-1,c=-1;for(r=e.length-1;r>=0;--r){const f=e.charCodeAt(r);if(47===f){if(!l){o=r+1;break}}else-1===c&&(l=!1,c=r+1),n>=0&&(f===t.charCodeAt(n)?-1==--n&&(i=r):(n=-1,i=c))}return o===i?i=c:-1===i&&(i=e.length),e.slice(o,i)}for(r=e.length-1;r>=0;--r)if(47===e.charCodeAt(r)){if(!l){o=r+1;break}}else-1===i&&(l=!1,i=r+1);return-1===i?"":e.slice(o,i)},dirname:function(e){if(n(e),0===e.length)return".";const t=47===e.charCodeAt(0);let r=-1,o=!0;for(let t=e.length-1;t>=1;--t)if(47===e.charCodeAt(t)){if(!o){r=t;break}}else o=!1;return-1===r?t?"/":".":t&&1===r?"//":e.slice(0,r)},extname:function(e){n(e);let t=-1,r=0,o=-1,i=!0,l=0;for(let n=e.length-1;n>=0;--n){const c=e.charCodeAt(n);if(47!==c)-1===o&&(i=!1,o=n+1),46===c?-1===t?t=n:1!==l&&(l=1):-1!==t&&(l=-1);else if(!i){r=n+1;break}}return-1===t||-1===o||0===l||1===l&&t===o-1&&t===r+1?"":e.slice(t,o)},isAbsolute:function(e){return n(e),e.length>0&&47===e.charCodeAt(0)},join:function(...e){if(0===e.length)return".";let t;for(let r=0,o=e.length;r<o;++r){const o=e[r];n(o),o.length>0&&(t?t+="/"+o:t=o)}return t?h(t):"."},normalize:h,parse:function(e){n(e);const t={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return t;const r=47===e.charCodeAt(0);let o;r?(t.root="/",o=1):o=0;let i=-1,l=0,c=-1,f=!0,h=e.length-1,s=0;for(;h>=o;--h){const t=e.charCodeAt(h);if(47!==t)-1===c&&(f=!1,c=h+1),46===t?-1===i?i=h:1!==s&&(s=1):-1!==i&&(s=-1);else if(!f){l=h+1;break}}return-1===i||-1===c||0===s||1===s&&i===c-1&&i===l+1?-1!==c&&(t.base=t.name=0===l&&r?e.slice(1,c):e.slice(l,c)):(0===l&&r?(t.name=e.slice(1,i),t.base=e.slice(1,c)):(t.name=e.slice(l,i),t.base=e.slice(l,c)),t.ext=e.slice(i,c)),l>0?t.dir=e.slice(0,l-1):r&&(t.dir="/"),t},relative:function(e,t){if(n(e),n(t),e===t)return"";if((e=f(e))===(t=f(t)))return"";let r=1;const o=e.length;for(;r<o&&47===e.charCodeAt(r);++r);const i=o-r;let l=1;const c=t.length;for(;l<c&&47===t.charCodeAt(l);++l);const h=c-l,s=i<h?i:h;let a=-1,d=0;for(;d<=s;++d){if(d===s){if(h>s){if(47===t.charCodeAt(l+d))return t.slice(l+d+1);if(0===d)return t.slice(l+d)}else i>s&&(47===e.charCodeAt(r+d)?a=d:0===d&&(a=0));break}const n=e.charCodeAt(r+d);if(n!==t.charCodeAt(l+d))break;47===n&&(a=d)}let u="";for(d=r+a+1;d<=o;++d)d!==o&&47!==e.charCodeAt(d)||(0===u.length?u+="..":u+="/..");return u.length>0?u+t.slice(l+a):(l+=a,47===t.charCodeAt(l)&&++l,t.slice(l))},resolve:f,sep:"/",delimiter:":"},g={basename:function(e,t=""){if(void 0!==t&&"string"!=typeof t)throw new TypeError('"ext" argument must be a string');n(e);let r,o=0,c=-1,f=!0;if(e.length>=2&&l(e.charCodeAt(0))&&58===e.charCodeAt(1)&&(o=2),void 0!==t&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";let n=t.length-1,l=-1;for(r=e.length-1;r>=o;--r){const h=e.charCodeAt(r);if(i(h)){if(!f){o=r+1;break}}else-1===l&&(f=!1,l=r+1),n>=0&&(h===t.charCodeAt(n)?-1==--n&&(c=r):(n=-1,c=l))}return o===c?c=l:-1===c&&(c=e.length),e.slice(o,c)}for(r=e.length-1;r>=o;--r)if(i(e.charCodeAt(r))){if(!f){o=r+1;break}}else-1===c&&(f=!1,c=r+1);return-1===c?"":e.slice(o,c)},dirname:function(e){n(e);const t=e.length;if(0===t)return".";let r=-1,o=-1,c=!0,f=0;const h=e.charCodeAt(0);if(t>1)if(i(h)){if(r=f=1,i(e.charCodeAt(1))){let n=2,o=n;for(;n<t&&!i(e.charCodeAt(n));++n);if(n<t&&n!==o){for(o=n;n<t&&i(e.charCodeAt(n));++n);if(n<t&&n!==o){for(o=n;n<t&&!i(e.charCodeAt(n));++n);if(n===t)return e;n!==o&&(r=f=n+1)}}}}else l(h)&&58===e.charCodeAt(1)&&(r=f=2,t>2&&i(e.charCodeAt(2))&&(r=f=3));else if(i(h))return e;for(let r=t-1;r>=f;--r)if(i(e.charCodeAt(r))){if(!c){o=r;break}}else c=!1;if(-1===o){if(-1===r)return".";o=r}return e.slice(0,o)},extname:function(e){n(e);let t=0,r=-1,o=0,c=-1,f=!0,h=0;e.length>=2&&58===e.charCodeAt(1)&&l(e.charCodeAt(0))&&(t=o=2);for(let n=e.length-1;n>=t;--n){const t=e.charCodeAt(n);if(i(t)){if(!f){o=n+1;break}}else-1===c&&(f=!1,c=n+1),46===t?-1===r?r=n:1!==h&&(h=1):-1!==r&&(h=-1)}return-1===r||-1===c||0===h||1===h&&r===c-1&&r===o+1?"":e.slice(r,c)},isAbsolute:function(e){n(e);const t=e.length;if(0===t)return!1;const r=e.charCodeAt(0);return!!i(r)||!!(l(r)&&t>2&&58===e.charCodeAt(1)&&i(e.charCodeAt(2)))},join:function(...e){const t=e.length;if(0===t)return".";let r,o=null;for(let i=0;i<t;++i){const t=e[i];n(t),t.length>0&&(void 0===r?r=o=t:r+="\\"+t)}if(void 0===r)return".";let l=!0,c=0;if(function(e,t=""){if(!e)throw new s(t)}(null!=o),i(o.charCodeAt(0))){++c;const e=o.length;e>1&&i(o.charCodeAt(1))&&(++c,e>2&&(i(o.charCodeAt(2))?++c:l=!1))}if(l){for(;c<r.length&&i(r.charCodeAt(c));++c);c>=2&&(r="\\"+r.slice(c))}return d(r)},normalize:d,parse:function(e){n(e);const t={root:"",dir:"",base:"",ext:"",name:""},r=e.length;if(0===r)return t;let o=0,c=e.charCodeAt(0);if(r>1){if(i(c)){if(o=1,i(e.charCodeAt(1))){let t=2,n=t;for(;t<r&&!i(e.charCodeAt(t));++t);if(t<r&&t!==n){for(n=t;t<r&&i(e.charCodeAt(t));++t);if(t<r&&t!==n){for(n=t;t<r&&!i(e.charCodeAt(t));++t);t===r?o=t:t!==n&&(o=t+1)}}}}else if(l(c)&&58===e.charCodeAt(1)){if(o=2,!(r>2))return t.root=t.dir=e,t;if(i(e.charCodeAt(2))){if(3===r)return t.root=t.dir=e,t;o=3}}}else if(i(c))return t.root=t.dir=e,t;o>0&&(t.root=e.slice(0,o));let f=-1,h=o,s=-1,a=!0,d=e.length-1,u=0;for(;d>=o;--d)if(c=e.charCodeAt(d),i(c)){if(!a){h=d+1;break}}else-1===s&&(a=!1,s=d+1),46===c?-1===f?f=d:1!==u&&(u=1):-1!==f&&(u=-1);return-1===f||-1===s||0===u||1===u&&f===s-1&&f===h+1?-1!==s&&(t.base=t.name=e.slice(h,s)):(t.name=e.slice(h,f),t.base=e.slice(h,s),t.ext=e.slice(f,s)),t.dir=h>0&&h!==o?e.slice(0,h-1):t.root,t},relative:function(e,t){if(n(e),n(t),e===t)return"";const r=a(e),o=a(t);if(r===o)return"";if((e=r.toLowerCase())===(t=o.toLowerCase()))return"";let i=0,l=e.length;for(;i<l&&92===e.charCodeAt(i);++i);for(;l-1>i&&92===e.charCodeAt(l-1);--l);const c=l-i;let f=0,h=t.length;for(;f<h&&92===t.charCodeAt(f);++f);for(;h-1>f&&92===t.charCodeAt(h-1);--h);const s=h-f,d=c<s?c:s;let u=-1,g=0;for(;g<=d;++g){if(g===d){if(s>d){if(92===t.charCodeAt(f+g))return o.slice(f+g+1);if(2===g)return o.slice(f+g)}c>d&&(92===e.charCodeAt(i+g)?u=g:2===g&&(u=3));break}const r=e.charCodeAt(i+g);if(r!==t.charCodeAt(f+g))break;92===r&&(u=g)}if(g!==d&&-1===u)return o;let C="";for(-1===u&&(u=0),g=i+u+1;g<=l;++g)g!==l&&92!==e.charCodeAt(g)||(0===C.length?C+="..":C+="\\..");return C.length>0?C+o.slice(f+u,h):(f+=u,92===o.charCodeAt(f)&&++f,o.slice(f,h))},resolve:a,sep:"\\",delimiter:";"};return g.posix=u.posix=u,g.win32=u.win32=g,t.isGlob=function(e){const t={"{":"}","(":")","[":"]"},r=/\\(.)|(^!|\*|[\].+)]\?|\[[^\\\]]+\]|\{[^\\}]+\}|\(\?[:!=][^\\)]+\)|\([^|]+\|[^\\)]+\))/;if(""===e)return!1;let n;for(;n=r.exec(e);){if(n[2])return!0;let r=n.index+n[0].length;const o=n[1],i=o?t[o]:null;if(o&&i){const t=e.indexOf(i,r);-1!==t&&(r=t+1)}e=e.slice(r)}return!1},t.posix=u,t.win32=g,t};